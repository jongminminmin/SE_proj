<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #f0f0f0;
            margin: 0;
        }
        .container {
            background: #fafafa;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 400px;
            padding: 30px;
            box-sizing: border-box;
        }
        .container h2 {
            text-align: center;
            margin-bottom: 10px;
            font-family: Inter, sans-serif;
            font-size: 24px;
            font-weight: 600;
        }
        .container p {
            text-align: center;
            font-family: Inter, sans-serif;
            font-size: 16px;
            margin-bottom: 20px;
            color: #333;
        }
        .error {
            color: #c00;
            font-size: 14px;
            text-align: center;
            margin-bottom: 12px;
            display: none;
        }
        .input-field {
            width: 100%;
            height: 40px;
            padding: 8px 16px;
            margin-bottom: 16px;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
            color: #333;
        }
        .btn-action {
            width: 100%;
            height: 40px;
            padding: 8px 16px;
            background: black;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 12px;
        }
        .btn-social {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 40px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            background: #EEEEEE;
            color: #444;
        }
        .btn-social .icon {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            display: inline-block;
            /* 간단히 배경색 블록으로 구글 로고 대체 */
            background: url('data:image/svg+xml;utf8,\
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 533.5 544.3">\
<path fill="#4285F4" d="M533.5 278.4c0-17.8-1.4-35-4-51.6H272v97.7h146.9c-6.4 35.2-25.4 64.9-54.3 85l88 68.3c51.4-47.4 81-117.2 81-199.4z"/><path fill="#34A853" d="M272 544.3c73.4 0 135-24.2 180-65.7l-88-68.3c-24 16.2-55 25.8-92 25.8-70.7 0-130.5-47.7-152-111.7l-89 68.7c44 87.7 134.8 151.2 241 151.2z"/><path fill="#FBBC05" d="M120 324.6c-10.2-30.7-10.2-63.8 0-94.5l-89-68.7C6 200.8 0 235.8 0 272s6 71.2 31 111.6l89-68.7z"/><path fill="#EB4335" d="M272 107.7c39.9-.6 78.2 14.1 107.3 40.7l80.4-80.4C405.3 21.7 343.8-2.4 272 0 165.8 0 75 63.5 31 151.2l89 68.7C141.5 155.4 201.3 107.7 272 107.7z"/>\
</svg>') no-repeat center center;
            background-size: contain;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>Login</h2>
    <p>Enter your username and password</p>
    <div id="error" class="error"></div>

    <input
            id="username"
            class="input-field"
            type="text"
            placeholder="Username"
            autocomplete="username"
    />
    <input
            id="password"
            class="input-field"
            type="password"
            placeholder="Password"
            autocomplete="current-password"
    />

    <button id="loginBtn" class="btn-action">Log in</button>

    <!-- 구글 소셜 로그인 버튼 추가 -->
    <button id="googleBtn" class="btn-social">
        <span class="icon"></span>
        Continue with Google
    </button>
</div>

<script>
    // 기존 로그인 처리
    document.getElementById('loginBtn').addEventListener('click', async () => {
        const errEl = document.getElementById('error');
        errEl.style.display = 'none';
        errEl.textContent = '';

        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;

        if (!username || !password) {
            errEl.textContent = 'Username과 password를 모두 입력하세요.';
            errEl.style.display = 'block';
            return;
        }

        try {
            const resp = await fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });
            const result = await resp.json();

            if (resp.ok && result.success) {
                window.location.href = '/';
            } else {
                errEl.textContent = result.message || '로그인에 실패했습니다.';
                errEl.style.display = 'block';
            }
        } catch (e) {
            console.error(e);
            errEl.textContent = '서버와 통신 중 오류가 발생했습니다.';
            errEl.style.display = 'block';
        }
    });

    // 구글 OAuth2 로그인 리다이렉트
    document.getElementById('googleBtn').addEventListener('click', () => {
        window.location.href = /*[[@{/oauth2/authorization/google}]]*/ '/oauth2/authorization/google';
    });
</script>
</body>
</html>
